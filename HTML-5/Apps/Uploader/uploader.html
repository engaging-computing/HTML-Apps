<!DOCTYPE html>
<html>
	<head>
		<!-- Define the character set for this HMTL file. -->
		<meta charset="UTF-8">

		<!-- CSS file -->
		<link rel="stylesheet" type="text/css" href="uploader.css" />

		<!-- Javascript files (jQuery + javascript source) -->
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js">
		</script>
		<script src="uploader.js"></script>

		<!-- Google Maps API script -->
		<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>

        <!-- Changes the title in the browser's tab -->
		<title>iSENSE Uploader</title>
	</head>
	<body>
		<h1>iSENSE Uploader</h1>

		<!-- When the user wants to enter an email/password, these divs are populated. -->
		<div id="user_prompt"></div>
		<div align="left" id="submit_user"></div>

		<!-- 	Buttons for changing parts of the WebApp.
				Currently only Project & Title really work well. -->
		<br/>
		<button id="buttonz" onClick="popup_user()">Click here <br/>to Login</button>
		<button id="buttonz" onClick="popup_contributor()">Click here to add a Contributor Key</button>
		<button id="buttonz" onClick="popup_projID()">Click here to change <br/> the Project ID</button>
		<button id="buttonz" onClick="popup_title()">Click here to change <br/> the title</button>

		<br/><br/>

		<!-- Left aligned & in a table to make it off to the left and look pretty. -->
		<div id="left">
			<table>
				<tr>
					<td align="right">CURRENT USER:</td>
					<td align="left"><span id="user_id">--</span></td>
				</tr>

				<tr>
					<td align="right">CONTRIBUTOR KEY:</td>
					<td align="left"><span id="contrib_key">--</span></td>
				</tr>

				<tr>
					<td align="right">PROJECT ID:</td>
					<td align="left"><span id="project_num">--</span></td>
				</tr>

				<tr>
					<td align="right">PROJECT TITLE:</td>
					<td align="left"><span id=project_title>--</span></td>
				</tr>
			</table>
		</div>

		<p>Results/Fields will show up below this line.</p>

		<div id="left">
			<p><div id="resp"></div></p>
			<p><div id="user_input"></div></p>
		</div>

		<table>
			<div id="Upload"></div>
		</table>

		<!-- The URL is added to this div. -->
		<div id="The_URL">
			The URL to the project that you contributed to will appear here!
		</div><br/>

		<!-- This is button is how the user grabs fields from iSENSE
			 and later submits the data to iSENSE -->
		<div id="change_me">
			<button id="rSENSE" onclick="get_fields()">
				Click here to pull information from rSENSE
			</button>
		</div>

		<!-- Forces the Google Maps canvas to the center -->
		<style type="text/css">
			div#mapcanvas { margin: 0 auto 0 auto; }
		</style>

		<!-- The Google Map shows up here. -->
		<article>
		  	<p>Trying to find your location: <span id="status">checking...</span></p>
		</article>

		<!-- 	The following was originally from: http://html5demos.com/geo
				I've since modified it for the Water Testing App
				And now for the iSENSE Uploader App					-->
		<script>
			// If we can get the user's location, this function goes off.
			function success(position) {
			  	var s = document.querySelector('#status');

			  	if (s.className == 'success') {
					// Not sure why we're hitting this twice in FF.
					// I think it's to do with a cached result coming bac
					return;
			  	}

                // Updates the HTML file
			  	s.innerHTML = "found you!";
			  	s.className = 'success';

			 	// Makes a map canvas
			  	var mapcanvas = document.createElement('div');
			  	mapcanvas.id = 'mapcanvas';
			  	mapcanvas.style.height = '600px';
			  	mapcanvas.style.width  = '1200px';

				// Adds the map canvas to the HTML
			  	document.querySelector('article').appendChild(mapcanvas);

                // Get latitude and longitude
			   	 lat = position.coords.latitude;
			  	long = position.coords.longitude;

                // Updates the HTML to show the accuracy of the geolocation ping.
			   	document.getElementById("accurate").innerHTML =
			   	"You are here! (at least within a "
			   	+ position.coords.accuracy + " meter radius)";

                // Settings for the Google Map that shows up if we can get a user's
                // location.
			   	var latlng = new google.maps.LatLng(position.coords.latitude,
			   										position.coords.longitude);
			  	var myOptions = {
					zoom: 18,
					center: latlng,
					mapTypeControl: true,
					navigationControlOptions: {style: google.maps.NavigationControlStyle.SMALL},
					navigationControl: true,
					mapTypeId: google.maps.MapTypeId.HYBRID
			  	};
			  	var map = new google.maps.Map(document.getElementById("mapcanvas"), myOptions);

                //  Makes a Google Maps Marker for the
			  	var marker = new google.maps.Marker({
					position: latlng,
				  	map: map,
				  	title: "YOU ARE HERE!"
			  	});
			}

			// We couldn't get the user's location
			function error(msg) {
			  	var s = document.querySelector('#status');
			  	s.innerHTML = typeof msg == 'string' ? msg : "failed";
			  	s.className = 'fail';
			}

			// We couldn't get the user's location
			if (navigator.geolocation) {
			  	navigator.geolocation.getCurrentPosition(success, error);
			} else {
			  	error('not supported');
			}
		</script>

        <!-- Shows the accuracy of this location test. Likely not as accurate
             as GPS as it usually pings Google's servers and/or other servers to
             get an estimate of a user's lat & long.     -->
		<div id="accurate"></div> <br/>
		NOTE: the HTML5 geolocation feature is not as accurate as GPS. <br/>
    	As a result the location may be off slightly. <br/>

        <!--    After submitting, the URL to the project is shown below. -->
		<p>NOTE: required at a mininium is a username/password or a contributor key, <br/>
		as well as a project ID for the project you'd like to contribute to. </p>

        <!--    Simple index button - clicking it brings you up a level, to the
                Index of all the WebApps. -->
		<p><a href="../webapps.html">
			Return to the WebApps index</a></p>

	</body>
</html>
